<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">

<title>바라미 - 스킬</title>
<meta content="" name="description">
<meta content="" name="keywords">

<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="assets/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon-16x16.png">
<!-- <link rel="manifest" href="assets/img/site.webmanifest"> -->

<!-- Google Fonts -->
<link href="https://fonts.gstatic.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

<!-- Vendor CSS Files -->
<link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
<link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
<link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
<link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
<link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
<link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

<!-- Template Main CSS File -->
<link href="assets/css/style.css" rel="stylesheet">
<link href="assets/css/skill.css" rel="stylesheet">

</head>
<body>
  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">
    <div class="d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center">
      <img src="assets/img/android-chrome-192x192.png" alt="">
      <span class="d-none d-lg-block">바라미</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">

        <li class="nav-item dropdown pe-3">
          <a class="nav-link nav-profile d-flex align-items-center pe-0" data-bs-toggle="dropdown">
            <img src="assets/img/android-chrome-192x192.png" alt="Profile" class="rounded-circle">
            <span class="d-none d-md-block dropdown-toggle ps-2 auth-name"></span>
          </a><!-- End Profile Iamge Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile p-0">
            <li>
              <a class="dropdown-item d-flex align-items-center sign-btn">
                <i class="bi bi-box-arrow-right"></i>
                <span class="sign-btn-label"></span>
              </a>
            </li>

          </ul><!-- End Profile Dropdown Items -->
        </li><!-- End Profile Nav -->

      </ul>
    </nav><!-- End Icons Navigation -->
  </header>
  <!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar" data-include-path="common/sidebar.html">
    <ul class="sidebar-nav" id="sidebar-nav">
      <li class="nav-item">
        <a class="nav-link collapsed" href="index.html">
          <i class="bi bi-card-list"></i>
          <span>환수 정보</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" href="influence.html">
          <i class="bi bi-trophy-fill"></i>
          <span>결속 추천</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" href="summon.html">
          <i class="ri-heart-3-fill"></i>
          <span>환수 소환</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" href="enhance.html">
          <i class="bi bi-hammer"></i>
          <span>장비 강화</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" href="option.html">
          <i class="ri-magic-fill"></i>
          <span>성능 추가</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="skilltree.html?job=1">
          <i class="bi bi-ui-checks-grid"></i>
          <span>스킬 트리</span>
          <span class="badge bg-primary ms-2">Beta</span>
        </a>
      </li>
    </ul>
    </ul>
  </aside>
  <!-- End Sidebar-->

  <main id="main" class="main">
    <section class="section">
      <div class="job-container">
        <div class="job-btn active">
        </div>
        <div class="title-container d-flex">
          <input type="text" class="title-input" placeholder="제목" maxlength="50"/>
          <button type="button" class="btn btn-primary skill-like" style="display: none;">
            즐겨찾기 <i class="bi bi-star"></i>
          </button>
        </div>
      </div>

      <div class="filter">

      </div>
    </section>

    <div class="row mb-1">
      <ins class="kakao_ad_area" style="display:none;"
      data-ad-unit = "DAN-lOqeBgJ4uYAgcjX8"
      data-ad-width = "320"
      data-ad-height = "100"></ins>
    </div>

    <section class="section">
      <div class="row m-auto">
        <div class="col-sm-12 col-md-6 col-lg-6 skill-list-container mb-2 p-0">
          <div class="btn-group mb-2" role="group">
            <button type="button" class="btn bystyle-tab bystyle-tab-off" data-id="0">전투</button>
            <button type="button" class="btn bystyle-tab bystyle-tab-off" data-id="1">전술</button>
            <button type="button" class="btn bystyle-tab bystyle-tab-off" data-id="2">보조</button>
            <button type="button" class="btn bystyle-tab bystyle-tab-off" data-id="3">승급</button>
            <button type="button" class="btn bystyle-tab bystyle-tab-off" data-id="4">신수</button>
            <button type="button" class="btn bystyle-tab bystyle-tab-off" data-id="5">연계</button>

            <div class="safe-container safe-container2"></div>
          </div>

          <div class="mh-300 d-flex">
            <div class="skill-list">
              
            </div>

            <div class="skill-list">

            </div>

            <div class="skill-list">

            </div>

            <div class="skill-list">

            </div>

            <div class="skill-list">

            </div>

            <div class="skill-list">

            </div>
          </div>

          <div class="upgrade-group">
            <div class="radiobox">
              <label class="radiobox-wrapper">
                <input type="radio" class="upgrade-input" name="upgrade-radio" data-id="0" checked />
                <span class="upgrade-tile">
                  <span class="upgrade-icon">
                    <i class="bi bi-suit-diamond-fill"></i>
                  </span>
                  <span class="upgrade-label">개조</span>
                </span>
              </label>
            </div>
            <div class="radiobox">
              <label class="radiobox-wrapper">
                <input type="radio" class="upgrade-input" name="upgrade-radio" data-id="1" />
                <span class="upgrade-tile">
                  <span class="upgrade-icon">
                    <i class="bi bi-sun-fill"></i>
                  </span>
                  <span class="upgrade-label">창조</span>
                </span>
              </label>
            </div>
            <div class="radiobox">
              <label class="radiobox-wrapper">
                <input type="radio" class="upgrade-input" name="upgrade-radio" data-id="2"/>
                <span class="upgrade-tile">
                  <span class="upgrade-icon">
                    <i class="bi bi-moon-fill"></i>
                  </span>
                  <span class="upgrade-label">지배</span>
                </span>
              </label>
            </div>
          </div>

          <div class="skill-info-container d-flex p-2">
            <div class="skill-icon me-2">
              
            </div>
            <div class="skill-desc-container">
              <span class="skill-title"></span>
              <span class="skill-desc"></span>
              <span class="skill-upgrade"></span>
            </div>
            <div class="skill-effect-container">
              <span class="skill-coast"></span>
              <span class="skill-cool"></span>
              <span class="skill-count"></span>
              <span class="skill-effect"></span>
            </div>

            <div class="safe-container"></div>
          </div>

          <div class="d-block" style="max-height: inherit; position: relative;">
            <div class="row m-0" style="position: relative;">
              <button class="bystyle-btn-orange btn skill-setting-btn col-8" type="button" data-target="#skill-setting-container" aria-expanded="false" aria-controls="skill-setting-container">
                <i class="bi bi-gear-fill"></i>
              </button>

              <button class="bystyle-btn-red btn skill-set-btn col-4" type="button" style="white-space: nowrap;" data-active="false">
                슬롯 장착
              </button>

              <div class="safe-container2"></div>
            </div>

            <div class="skill-setting-container p-3 collapse" id="skill-setting-container" data-toggle="collapse">
              <div class="row mb-3" style="position: relative;">
                <label class="col-sm-2 col-form-label text-light">자동 설정</label>
                <div class="col-sm-10">
                  <select class="form-select priority-select">
                    <option value="3">최우선 사용</option>
                    <option value="2">우선 사용</option>
                    <option selected="" value="1">일반 사용</option>
                    <option value="0">사용 안함</option>
                  </select>
                </div>

                <div class="safe-container2"></div>
              </div>

              <div class="row mb-3 skill-coast-container">
                <label class="col-sm-2 col-form-label text-light">사용 설정</label>
                <div class="col-sm-10">
                  <div class="col-sm-12 mb-3">
                    <div>
                      <label id="hp-label" for="hp-range" class="form-label text-light" data-value="50">체력 50%</label>
                      <div class="btn-group" style="float: right;">
                        <input type="radio" class="btn-check" name="options1" id="btn-hp-1" autocomplete="off" data-type="hp" data-id="1" />
                        <label class="btn btn-secondary" for="btn-hp-1">이상 ▲</label>
                      
                        <input type="radio" class="btn-check" name="options1" id="btn-hp-2" autocomplete="off" data-type="hp" data-id="2" />
                        <label class="btn btn-secondary" for="btn-hp-2">이하 ▼</label>
                      
                        <input type="radio" class="btn-check" name="options1" id="btn-hp-3" autocomplete="off" data-type="hp" data-id="3" checked/>
                        <label class="btn btn-secondary" for="btn-hp-3">사용 안함</label>
                      </div>
                      <input type="range" class="form-range mt-2" id="hp-range" min="5" max="95" step="5" value="50" style="display: none;" disabled>
                    </div>
                  </div>
                  <div class="col-sm-12">
                    <div>
                      <label id="mp-label" for="mp-range" class="form-label text-light" data-value="50">마력 50%</label>
                      <div class="btn-group" style="float: right;">
                        <input type="radio" class="btn-check" name="options2" id="btn-mp-1" autocomplete="off" data-type="mp" data-id="1" />
                        <label class="btn btn-secondary" for="btn-mp-1">이상 ▲</label>
                      
                        <input type="radio" class="btn-check" name="options2" id="btn-mp-2" autocomplete="off" data-type="mp" data-id="2" />
                        <label class="btn btn-secondary" for="btn-mp-2">이하 ▼</label>
                      
                        <input type="radio" class="btn-check" name="options2" id="btn-mp-3" autocomplete="off" data-type="mp" data-id="3" checked/>
                        <label class="btn btn-secondary" for="btn-mp-3">사용 안함</label>
                      </div>
                      <input type="range" class="form-range mt-2" id="mp-range" min="5" max="95" step="5" value="50" style="display: none;" disabled>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row mb-3 skill-awake-container">
                <label class="col-sm-2 col-form-label text-light">기술 각성</label>
                <div class="col-sm-10" style="margin: auto;">
                  <input class="form-check-input" type="checkbox" value="" id="skill-awake-check">
                </div>
              </div>

              <div class="row mb-3 skill-combo-container">
                <label class="col-sm-2 col-form-label text-light">기술 연계</label>
                <div class="col-sm-10 skill-combo-list" style="margin: auto;">
                  <div class="skill-combo" data-idx="0"><div class="skill-item"><div class="skill-bg"></div></div></div>
                  <div class="skill-combo" data-idx="1"><div class="skill-item"><div class="skill-bg"></div></div></div>
                  <div class="skill-combo" data-idx="2"><div class="skill-item"><div class="skill-bg"></div></div></div>
                  <div class="skill-combo" data-idx="3"><div class="skill-item"><div class="skill-bg"></div></div></div>
                  <div class="skill-combo" data-idx="4"><div class="skill-item"><div class="skill-bg"></div></div></div>
                  <div class="combo-btn-container">
                    <button class="bystyle-btn-red btn skill-combo-set-btn" type="button" data-active="false">
                      <i class="bi bi-gear-fill"></i>
                    </button>
                  </div>
                </div>
              </div>

              <div class="row mb-3 skill-fire-container">
                <label class="col-sm-2 col-form-label text-light">도깨비불</label>
                <div class="col-sm-10">
                  <div class="col-sm-12 mb-3">
                    <div>
                      <div class="btn-group" style="float: right;">
                        <input type="radio" class="btn-check" name="fire-options" id="btn-fire-1" autocomplete="off" data-id="0" checked/>
                        <label class="btn btn-secondary" for="btn-fire-1">상관 없음</label>
                      
                        <input type="radio" class="btn-check" name="fire-options" id="btn-fire-2" autocomplete="off" data-id="1"/>
                        <label class="btn btn-secondary" for="btn-fire-2">최대 개수</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
            </div>

            <div class="safe-container">
              <button class="bystyle-btn-red btn skill-set-done-btn col-4" type="button" style="white-space: nowrap; float: right;" data-active="false">
                완료
              </button>
            </div>
          </div>
          
        </div>

        <div class="col-sm-12 col-md-6 col-lg-6 pe-0 mb-2" style="position: relative; min-width: 320px;">
          <div class="btn-group mb-2 w-100" role="group">
            <ul class="nav nav-tabs nav-tabs-bordered w-100" id="type-tab" role="tablist">
              <li class="nav-item flex-fill" role="presentation">
                <button class="nav-link w-100 active type-tab" data-id="0" data-bs-toggle="tab" data-bs-target="#page-contents1" type="button" role="tab" aria-selected="true">사냥</button>
              </li>
              <li class="nav-item flex-fill" role="presentation">
                <button class="nav-link w-100 type-tab" data-id="1" data-bs-toggle="tab" data-bs-target="#page-contents2" type="button" role="tab" aria-selected="false">보스</button>
              </li>
              <li class="nav-item flex-fill" role="presentation">
                <button class="nav-link w-100 type-tab" data-id="2" data-bs-toggle="tab" data-bs-target="#page-contents3" type="button" role="tab" aria-selected="false">PVP</button>
              </li>
            </ul>

            <div class="safe-container"></div>
          </div>

          <div class="tab-content">
            <div class="tab-pane fade show active page-contents" id="page-contents1" role="tabpanel">
              
            </div>

            <div class="tab-pane fade page-contents" id="page-contents2" role="tabpanel">
              
            </div>

            <div class="tab-pane fade page-contents" id="page-contents3" role="tabpanel">
              
            </div>
          </div>

          <button class="bystyle-btn-red btn btn-save col-4" type="button" style="display: none;">
            등록
          </button>

          <div class="safe-container2"></div>
          <div class="loading-container">
            <div class="spinner-border text-light loading-spinner" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
      </div>
    </section>
  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer" data-include-path="common/footer.html">
    <div class="copyright">
      &copy; Copyright <strong><span>DEV</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
      <!-- All the links in the footer should remain intact. -->
      <!-- You can delete the links only if you purchased the pro version. -->
      <!-- Licensing information: https://bootstrapmade.com/license/ -->
      <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/ -->
      Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
    </div>
  </footer>
  <!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.min.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.min.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.1.0/kakao.min.js" integrity="sha384-dpu02ieKC6NUeKFoGMOKz6102CLEWi9+5RQjWSV0ikYSFFd8M3Wp2reIcquJOemx" crossorigin="anonymous"></script>
  <script async type="text/javascript" src="https://t1.daumcdn.net/kas/static/ba.min.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
  <script src="assets/js/jquery.iframetracker.js"></script>
  <script src="assets/js/skill.min.js?ver=20230922"></script>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-analytics.js";
    import { getFirestore, collection, doc, addDoc, getDoc, getDocs, setDoc, deleteDoc, serverTimestamp, increment, query, where, updateDoc, getCountFromServer } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-firestore.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyBi20Vfz4FIEprruKEdWB2c_paicWCl6jI",
      authDomain: "baramy-9cb08.firebaseapp.com",
      projectId: "baramy-9cb08",
      storageBucket: "baramy-9cb08.appspot.com",
      messagingSenderId: "912929312520",
      appId: "1:912929312520:web:732acdc9a4f70b8e6866bd",
      measurementId: "G-RG02W3NYLF"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();
    const checkAuth = getAuth();
    var loginUid = '';

    if (checkAuth.currentUser) {
      loginUid = checkAuth.currentUser.uid;
      $('.auth-name').text(checkAuth.currentUser.displayName);
      $('.rounded-circle').attr('src', checkAuth.currentUser.photoURL);
      $('.sign-btn-label').text('로그아웃');
    } else {
      $('.auth-name').text('계정');
      $('.rounded-circle').attr('src', 'assets/img/android-chrome-192x192.png');
      $('.sign-btn-label').text('로그인');
    }

    function handleGoogleLogin() {
      signInWithPopup(checkAuth, provider)
        .then((result) => {
          location.reload();
        }).catch((error) => {
          $('.auth-name').text('계정');
          $('.rounded-circle').attr('src', 'assets/img/android-chrome-192x192.png');
          $('.sign-btn-label').text('로그인');
        });
    }

    onAuthStateChanged(checkAuth, (user) => {
      if (user) {
        loginUid = checkAuth.currentUser.uid;
        $('.auth-name').text(user.displayName);
        $('.rounded-circle').attr('src', user.photoURL);
        $('.sign-btn-label').text('로그아웃');
        checkLike();
      } else {
        $('.auth-name').text('계정');
        $('.rounded-circle').attr('src', 'assets/img/android-chrome-192x192.png');
        $('.sign-btn-label').text('로그인');
      }
    });

    $('.sign-btn').on('click', function() {
      if (checkAuth.currentUser) {
        checkAuth.signOut().then(function() {
          location.reload();
        });
      } else {
        handleGoogleLogin();
      }
    });

    $(function() {
      $.getJSON("https://api64.ipify.org?format=jsonp&callback=?", function(json) {
        userIp = json.ip;

        setTimeout(function() {
          document.querySelectorAll('.kakao_ad_area').forEach((ad) => { 
            let adUnit = $(ad).attr('data-ad-unit');
            ad.querySelectorAll('iframe').forEach((iframe) => {
              $('#' + iframe.id).iframeTracker({
                blurCallback: e => {
                  ipLog("DAN-lOqeBgJ4uYAgcjX8", (new Date()).toLocaleString(), navigator.userAgent, window.location.href, userIp);
                }
              });
            });
          });
        }, 1000);
      });
    });

    function ipLog(adUnit, date, userAgent, url, ip) {
      try {
        const docRef = addDoc(collection(db, "ADLog"), {
          adUnit: adUnit,
          date: date,
          userAgent: userAgent,
          ip: ip,
          url: url
        });
      } catch (e) {
      }
    }

    function addSkill(job, hunt, boss, pvp, coast, awake, title) {
      if (loginUid != '') {
        try {
          const skillsRef = collection(db, 'skill');
          addDoc(skillsRef, {
              job: parseInt(job),
              hunt: hunt,
              boss: boss,
              pvp: pvp,
              coast: coast,
              awake: awake,
              title: title,
              uid: loginUid,
              like: 0,
              date: serverTimestamp()
          }).then((docRef) => {
              location.href = 'skilltree.html?job=' + job;
          })
          .catch((error) => {
              console.error("Error adding document: ", error);
              alert('등록 실패');
          });
        } catch (e) {
          console.error("Error adding document: ", e);
          alert('등록 실패');
        }
      } else {
        alert('로그인이 필요합니다.');
      }
    };

    function updateSkill(job, hunt, boss, pvp, coast, awake, title) {
      if (loginUid != '') {
        try {
          const updateQuery = query(doc(collection(db, 'skill'), docId));
          updateDoc(updateQuery, {
              hunt: hunt,
              boss: boss,
              pvp: pvp,
              coast: coast,
              awake: awake,
              title: title
          }).then((docRef) => {
              location.href = 'skilltree.html?job=' + job;
          }).catch((error) => {
              console.error("Error adding document: ", error);
              alert('등록 실패');
          });
        } catch (e) {
          console.error("Error adding document: ", e);
          alert('등록 실패');
        }
      } else {
        alert('로그인이 필요합니다.');
      }
    }

    var userIp;
    const dataList = (new GlobalSkill().getData())();
    var jobSkill = [];
    var selectSkill = null;
    var comboSelectSkill = null;
    var isLoading = false;

    var job = '1';
    var docId = '';
    var docUid = '';
    var docTitle = '';
    var upgrade = [0, 0, 0];

    const parameter = new URLSearchParams(window.location.search);
    if (parameter.get('job') && ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'].includes(parameter.get('job'))) job = parameter.get('job');
    if (parameter.get('id')) docId = parameter.get('id');

    $('.job-btn').append('<img src="assets/img/icon_job_' + job + '_6.png">');
    $('.job-btn').append('<span>' + getJobName(job) +'</span>');

    if (job == '8') {
      $('.upgrade-group').css('display', 'flex');
    } else {
      $('.upgrade-group').remove();
    }

    if (job == '9') {
      $('.skill-fire-container').css('display', 'flex');
    } else {
      $('.skill-fire-container').remove();
    }

    for (var i=0; i<dataList.length; i++) {
      if (dataList[i].job == job) {
        if (selectSkill == null) selectSkill = dataList[i];

        jobSkill.push(dataList[i]);
      }
    }

    jobSkill.push({
      no: 'C0',
      job: job,
      skill: '기술 연계',
      x: 5,
      y: 0,
      awake: '',
      passive: '',
      desc: '',
      coast: '',
      cool: '',
      count: '',
      effect: '',
      type: 'NULL',
      upgrade: 'NULL',
      skills: []
    });

    jobSkill.push({
      no: 'C1',
      job: job,
      skill: '기술 연계',
      x: 5,
      y: 1,
      awake: '',
      passive: '',
      desc: '',
      coast: '',
      cool: '',
      count: '',
      effect: '',
      type: 'NULL',
      upgrade: 'NULL',
      skills: []
    });
    
    function getSkill(id) {
      isLoading = true;
      const docRef = doc(db, "skill", id);
      $('.loading-container').addClass('active');
      getDoc(docRef).then((item) => {
        isLoading = false;
        const data = item.data();
        if (data) {
          docUid = data.uid;
          docTitle = data.title;
          if (data.uid == loginUid) {
            $('.btn-save').text('수정');
            $('.btn-save').show();
            $('.title-input').prop('disabled', false);
          } else {
            $('.btn-save').remove();
            $('.title-input').prop('disabled', true);
            $('.skill-like').show();
          }
          
          $('.title-input').val(data.title);
          
          const hunt = JSON.parse(decodeURIComponent(data.hunt));
          const boss = JSON.parse(decodeURIComponent(data.boss));
          const pvp = JSON.parse(decodeURIComponent(data.pvp));
          const coast = JSON.parse(decodeURIComponent(data.coast));
          const awake = data.awake;
          for (var i=0; i<jobSkill.length; i++) {
            if (jobSkill[i].no == awake) {
              jobSkill[i].isAwake = true;
            }
            for (var j=0; j<13; j++) {
              // hunt
              if (jobSkill[i].no == hunt.skill[0][j] && hunt.skill[0][j] != '') {
                if (hunt.priority[0][j] != '') jobSkill[i].priority[0] = parseInt(hunt.priority[0][j]);
                if (coast[0][j] != null) jobSkill[i].use = coast[0][j];
                if (jobSkill[i].no == 'C0') jobSkill[i].skills = hunt.C0;
                if (jobSkill[i].no == 'C1') jobSkill[i].skills = hunt.C1;
                if (hunt.fire.includes(String(jobSkill[i].no))) jobSkill[i].upgrade = 'Y'; 
                docSkill[0][0][j] = '' + jobSkill[i].no;
              } else if (jobSkill[i].no == hunt.skill[1][j] && hunt.skill[1][j] != '') {
                if (hunt.priority[1][j] != '') jobSkill[i].priority[0] = parseInt(hunt.priority[1][j]);
                if (coast[0][j] != null) jobSkill[i].use = coast[0][j];
                if (jobSkill[i].no == 'C0') jobSkill[i].skills = hunt.C0;
                if (jobSkill[i].no == 'C1') jobSkill[i].skills = hunt.C1;
                docSkill[0][1][j] = '' + jobSkill[i].no;
                if (hunt.fire.includes(String(jobSkill[i].no))) jobSkill[i].upgrade = 'Y';
              }

              //boss
              if (jobSkill[i].no == boss.skill[0][j] && boss.skill[0][j] != '') {
                if (boss.priority[0][j] != '') jobSkill[i].priority[1] = parseInt(boss.priority[0][j]);
                if (coast[0][j] != null) jobSkill[i].use = coast[0][j];
                if (jobSkill[i].no == 'C0') jobSkill[i].skills = hunt.C0;
                if (jobSkill[i].no == 'C1') jobSkill[i].skills = hunt.C1;
                docSkill[1][0][j] = '' + jobSkill[i].no;
                if (boss.fire.includes(String(jobSkill[i].no))) jobSkill[i].upgrade = 'Y';
              } else if (jobSkill[i].no == boss.skill[1][j] && boss.skill[1][j] != '') {
                if (boss.priority[1][j] != '') jobSkill[i].priority[1] = parseInt(boss.priority[1][j]);
                if (coast[0][j] != null) jobSkill[i].use = coast[0][j];
                if (jobSkill[i].no == 'C0') jobSkill[i].skills = hunt.C0;
                if (jobSkill[i].no == 'C1') jobSkill[i].skills = hunt.C1;
                docSkill[1][1][j] = '' + jobSkill[i].no;
                if (boss.fire.includes(String(jobSkill[i].no))) jobSkill[i].upgrade = 'Y';
              }

              //pvp
              if (jobSkill[i].no == pvp.skill[0][j] && pvp.skill[0][j] != '') {
                if (pvp.priority[0][j] != '') jobSkill[i].priority[2] = parseInt(pvp.priority[0][j]);
                if (coast[0][j] != null) jobSkill[i].use = coast[0][j];
                if (jobSkill[i].no == 'C0') jobSkill[i].skills = hunt.C0;
                if (jobSkill[i].no == 'C1') jobSkill[i].skills = hunt.C1;
                docSkill[2][0][j] = '' + jobSkill[i].no;
                if (pvp.fire.includes(String(jobSkill[i].no))) jobSkill[i].upgrade = 'Y';
              } else if (jobSkill[i].no == pvp.skill[1][j] && pvp.skill[1][j] != '') {
                if (pvp.priority[1][j] != '') jobSkill[i].priority[2] = parseInt(pvp.priority[1][j]);
                if (coast[0][j] != null) jobSkill[i].use = coast[0][j];
                if (jobSkill[i].no == 'C0') jobSkill[i].skills = hunt.C0;
                if (jobSkill[i].no == 'C1') jobSkill[i].skills = hunt.C1;
                docSkill[2][1][j] = '' + jobSkill[i].no;
                if (pvp.fire.includes(String(jobSkill[i].no))) jobSkill[i].upgrade = 'Y';
              }
            }
          }

          if (job == '8') {
            upgrade[0] = hunt.upgrade;
            upgrade[1] = boss.upgrade;
            upgrade[2] = pvp.upgrade;
          }

        } else {
          $('.loading-container').html('');
        }
      });
    };

    function checkLike() {
      if (docId && docId != '' && loginUid != '') {
        const countQuery = query(collection(db, 'likes'), where('sid', '==', docId), where('uid', '==', loginUid));
        getCountFromServer(countQuery).then((result) => {
          if (result.data().count > 0) {
            $('.skill-like > i').removeClass('bi-star');
            $('.skill-like > i').addClass('bi-star-fill');
          }
        });
      }
    }

    if (docId != '') {
      await getSkill(docId);

      checkLike(docId);
    } else {
      $('.loading-container').removeClass('active');
      $('.loading-container').html('');
      $('.btn-save').show();
    }

    var skill_slot_items = ['', '', '', '', '', ''];
    var isFirst = true;
    var isFirstSelect = true;
    for (var i=0; i<jobSkill.length; i++) {
      if (jobSkill[i].no == '') jobSkill[i].no = 0;
      if (jobSkill[i].x == '') jobSkill[i].x = 0;
      if (jobSkill[i].y == '') jobSkill[i].y = 0;
      if (jobSkill[i].awake == '') jobSkill[i].awake = 0;
      if (jobSkill[i].passive == '') jobSkill[i].passive = 0;
      if (jobSkill[i].effect == '') jobSkill[i].effect = 0;
      if (!jobSkill[i].priority) jobSkill[i].priority = [1, 1, 1];

      if (jobSkill[i].no == 'C0' || jobSkill[i].no == 'C1') {
        continue;
      }
      
      let html = '<div class="skill-item" data-id="' + (jobSkill[i].no == '' ? '0' : jobSkill[i].no) + '">';
      html += '<div class="skill-bg slot2">';
      html += '<img src="assets/img/skill/ic_' + (jobSkill[i].no == '' ? '0' : jobSkill[i].no) + '.png">';
      html += '</div>';

      if (jobSkill[i].awake == 1) {
        if (isFirst) {
          html += '<div class="skill-special-slot active" data-id="' + jobSkill[i].no + '"></div>';
          jobSkill[i].isAwake = true;
          isFirst = false;
        } else {
          html += '<div class="skill-special-slot" data-id="' + jobSkill[i].no + '"></div>';
          jobSkill[i].isAwake = false;
        }
      }

      if (isFirstSelect) {
        html += '<div class="skill-select active" data-id="' + jobSkill[i].awake + '"></div>';
        isFirstSelect = false;
      } else {
        html += '<div class="skill-select" data-id="' + jobSkill[i].awake + '"></div>';
      }

      html += '</div>';

      var j = jobSkill[i].x == '' ? 0 : jobSkill[i].x;
      skill_slot_items[jobSkill[i].x == '' ? 0 : jobSkill[i].x] += html;
    }

    for (var i=0; i<2; i++) {
      let html = '<div class="skill-item" data-id="C' + i + '">';
      html += '<div class="skill-bg slot2 combo">';
      html += '<img src="assets/img/skill_icon_combo.png">'
      html += '<span>' + (i + 1) + '</span></div>';
      html += '<div class="skill-select" data-id="0"></div></div>';

      skill_slot_items[5] += html;
    }

    for (var i=0; i<skill_slot_items.length; i++) {
      $('.skill-list').eq(i).empty();
      $('.skill-list').eq(i).html(skill_slot_items[i]);
    }

    $('.skill-icon').html($('.skill-item').eq(0).html());
    $('.skill-icon').attr('data-id', $('.skill-item').eq(0).attr('data-id'));
    setSkillInfo($('.skill-item').eq(0).attr('data-id'));

    setTimeout(() => {
      for (var i=0; i<$('.page-contents').length; i++) {
        var docSkillPage = docSkill[i];
        var first = '<div class="skill-container mb-3" data-tab="' + i + '">';
        var second = '<div class="skill-container" data-tab="' + i + '">';
        
        for (var j=0; j<13; j++) {
          first += '<div class="skill-slot" data-tab="' + i + '" data-page="1"' + (docSkillPage[0][j] != '' ? (' data-id="' + docSkillPage[0][j] + '"') : '') + '><div class="skill-item"><div class="skill-bg"></div></div></div>';
          second += '<div class="skill-slot" data-tab="' + i + '" data-page="2"' + (docSkillPage[1][j] != '' ? (' data-id="' + docSkillPage[1][j] + '"') : '') + '><div class="skill-item"><div class="skill-bg"></div></div></div>';
        }

        first += '<div class="skill-slot" data-tab="' + i + '" data-page="1" disabled><div class="skill-item"><button type="button" class="btn skill-page-btn">1</button></div></div></div>';
        second += '<div class="skill-slot" data-tab="' + i + '" data-page="2" disabled><div class="skill-item"><button type="button" class="btn skill-page-btn">2</button></div></div></div>';

        $('.page-contents').eq(i).html(first + second);
      }

      for (var i=0; i<$('.skill-slot').length; i++) {
        if ($('.skill-slot').eq(i).attr('data-id')) {
          var skillId = $('.skill-slot').eq(i).attr('data-id');
          for (var j=0; j<jobSkill.length; j++) {
            if (jobSkill[j].no == skillId) {
              $('.skill-slot').eq(i).find('.skill-item').find('.skill-bg').addClass(['slot1', 'slot2', 'slot3',  'slot4'][jobSkill[j].priority[$('.skill-slot').eq(i).attr('data-tab')]]);
              if (skillId == 'C0' || skillId == 'C1') {
                $('.skill-slot').eq(i).find('.skill-item').find('.skill-bg').addClass('combo');
                $('.skill-slot').eq(i).find('.skill-item').find('.skill-bg').html('<img src="assets/img/skill_icon_combo.png"><span>' + (skillId == 'C0' ? '1' : '2') + '</span>');
              } else {
                $('.skill-slot').eq(i).find('.skill-item').find('.skill-bg').html('<img src="assets/img/skill/ic_' + skillId + '.png">');
              }

              if (jobSkill[j].awake == 1) {
                if (jobSkill[j].isAwake) {
                  $('.skill-slot').eq(i).find('.skill-item').append('<div class="skill-special-slot active" data-id="' + jobSkill[j].no + '"></div>');
                } else {
                  $('.skill-slot').eq(i).find('.skill-item').append('<div class="skill-special-slot" data-id="' + jobSkill[j].no + '"></div>');
                }
              }
              break;
            }
          }
        }
      }

      if (job == '8') {
        $('.upgrade-input').eq(upgrade[0]).prop('checked', true);
      }

      for (var i=0; i<$('.skill-list > .skill-item').length; i++) {
        for (var j=0; j<jobSkill.length; j++) {
          if ($('.skill-icon').attr('data-id') == jobSkill[j].no) {
            const priority = ['slot1', 'slot2', 'slot3', 'slot4'][jobSkill[j].priority[0]];
            if (!$('.skill-icon').find('.skill-bg').hasClass(priority)) {
              $('.skill-icon').find('.skill-bg').removeClass('slot1').removeClass('slot2').removeClass('slot3').removeClass('slot4');
              $('.skill-icon').find('.skill-bg').addClass(priority);
            }
          }
          if ($('.skill-list > .skill-item').eq(i).attr('data-id') == jobSkill[j].no) {
            const priority = ['slot1', 'slot2', 'slot3', 'slot4'][jobSkill[j].priority[0]];
            if (!$('.skill-list > .skill-item').eq(i).find('.skill-bg').hasClass(priority)) {
              $('.skill-list > .skill-item').eq(i).find('.skill-bg').removeClass('slot1').removeClass('slot2').removeClass('slot3').removeClass('slot4');
              $('.skill-list > .skill-item').eq(i).find('.skill-bg').addClass(priority);
            }
            break;
          }
        }
      }

      $('.loading-container').removeClass('active');
      $('.loading-container').html('');
    }, 2000);

    $(document).on('click', '.skill-list > .skill-item', function() {
      if (comboSelectSkill == null) {
        $('.skill-select').removeClass('active');
        $('.skill-select').removeClass('sactive');
        if ($(this).find('.skill-select').attr('data-id') == '1') {
          $(this).find('.skill-select').addClass('sactive');
        } else {
          $(this).find('.skill-select').addClass('active');
        }

        const icon = $(this).html();
        $('.skill-icon').html(icon);
        $('.skill-icon').attr('data-id', $(this).attr('data-id'));

        setSkillInfo($(this).attr('data-id'));
      } else {
        if (comboSelectSkill.skills.indexOf($(this).attr('data-id')) > -1) {
          return;
        }

        if ($(this).attr('data-id') == 'C0' || $(this).attr('data-id') == 'C1') {
          return;
        }

        for (var i=0; i<jobSkill.length; i++) {
          if (jobSkill[i].no == $(this).attr('data-id')) {
            if (jobSkill[i].passive == 0) {
              comboSelectSkill.skills.push($(this).attr('data-id'));
              setComboSkillContainer();
              break;
            }
          }
        }
      }
    });

    $('.skill-setting-btn').on('click', function() {
      $('.skill-setting-container').collapse('toggle');
    });

    function setSkillInfo(no) {
      for (var i=0; i<jobSkill.length; i++) {
        if (jobSkill[i].no == no) {
          selectSkill = jobSkill[i];

          $('.skill-title').text(jobSkill[i].skill);
          $('.skill-desc').text(jobSkill[i].desc);
          if (jobSkill[i].upgrade != 'NULL' && jobSkill[i].upgrade != 'N' && jobSkill[i].upgrade != 'Y') {
            $('.skill-upgrade').text('[' + jobSkill[i].type + '] ' + jobSkill[i].upgrade);
            $('.skill-upgrade').show();
          } else {
            $('.skill-upgrade').text('');
            $('.skill-upgrade').hide();
          }

          if (jobSkill[i].coast != 0) {
            $('.skill-coast').text('소모값 : ' + jobSkill[i].coast);
            $('.skill-coast').show();
          } else {
            $('.skill-coast').text('');
            $('.skill-coast').hide();
          }
          
          if (jobSkill[i].cool != 0) {
            $('.skill-cool').text('재사용 대기 : ' + jobSkill[i].cool + '초');
            $('.skill-cool').show();
          } else {
            $('.skill-cool').text('');
            $('.skill-cool').hide();
          }

          if (jobSkill[i].count != 0) {
            $('.skill-count').text('최대 적용 수 : ' + jobSkill[i].count);
            $('.skill-count').show();
          } else {
            $('.skill-count').text('');
            $('.skill-count').hide();
          }

          if (jobSkill[i].effect != 0) {
            $('.skill-effect').text('추가 효과 : ' + jobSkill[i].effect);
          } else {
            $('.skill-effect').text('추가 효과 : -');
          }

          if (jobSkill[i].awake != 0) {
            $('.skill-awake-container').show();

            if (jobSkill[i].isAwake) {
              $('#skill-awake-check').prop('checked', true);
            } else {
              $('#skill-awake-check').prop('checked', false);
            }
          } else {
            $('.skill-awake-container').hide();
          }

          $('.priority-select').val(jobSkill[i].priority[$('.type-tab.active').attr('data-id')]);

          if (jobSkill[i].passive == 1) {
            $('.skill-setting-container').collapse('hide');
            $('.skill-setting-btn').prop('disabled', true);
            $('.skill-set-btn').prop('disabled', true);
          } else {
            $('.skill-setting-btn').prop('disabled', false);
            $('.skill-set-btn').prop('disabled', false);
          }

          $('#hp-range').hide();
          $('#hp-range').prop('disabled', true);
          $('#hp-label').text('체력');
          $('#mp-range').hide();
          $('#mp-range').prop('disabled', true);
          $('#mp-label').text('마력');
          $('input[name=options1]').eq(2).prop('checked', true);
          $('input[name=options2]').eq(2).prop('checked', true);

          if (jobSkill[i].use) {
            const coast = jobSkill[i].use.split('/');
            for (var j=0; j<coast.length; j++) {
              const type = coast[j][0];
              const updown = coast[j].slice(-1) == 'U' ? 0 : 1;
              const index = (type == 'H' ? '1' : '2');
              const value = coast[j].substring(1, coast[j].length - 1);

              $('input[name=options' + index + ']').prop('checked', false);
              $('input[name=options' + index + ']').eq(updown).prop('checked', true);

              $('#' + (index == '1' ? 'hp-label' : 'mp-label')).text((index == '1' ? '체력' : '마력') + ' ' + value + '%');

              $('#' + (index == '1' ? 'hp-range' : 'mp-range')).prop('disabled', false);
              $('#' + (index == '1' ? 'hp-range' : 'mp-range')).val(value);
              $('#' + (index == '1' ? 'hp-range' : 'mp-range')).show();
            }
          }

          if (jobSkill[i].no === 'C0' || jobSkill[i].no === 'C1') {
            $('.skill-coast-container').hide();
            $('.skill-combo-container').show();

            for (var j=0; j<$('.skill-combo').length; j++) {
              $('.skill-combo').eq(j).find('.skill-item').find('.skill-bg').removeClass('slot2');
              $('.skill-combo').eq(j).find('.skill-item').find('.skill-bg').html('');
            }

            if (jobSkill[i].skills && jobSkill[i].skills.length > 0) {
              for (var j=0; j<$('.skill-combo').length; j++) {
                
                if (jobSkill[i].skills.length > j) {
                  
                  $('.skill-combo').eq(j).find('.skill-item').find('.skill-bg').addClass('slot2');
                  $('.skill-combo').eq(j).find('.skill-item').find('.skill-bg').html('<img src="assets/img/skill/ic_' + jobSkill[i].skills[j] + '.png">');
                }
              }
            }
          } else {
            $('.skill-coast-container').show();
            $('.skill-combo-container').hide();
          }

          if (job == '9') {
            if (jobSkill[i].upgrade == 'N' || jobSkill[i].upgrade == 'Y') {
              $('.skill-fire-container').css('display', 'flex');
              if (jobSkill[i].upgrade == 'N') {
                $('input[name=fire-options]').eq(0).prop('checked', true);
              } else {
                $('input[name=fire-options]').eq(1).prop('checked', true);
              }
            } else {
              $('.skill-fire-container').hide();
            }
          }
          break;
        }
      }
    }

    $('.priority-select').on('change', function() {
      const priority = ['slot1', 'slot2', 'slot3',  'slot4'][$(this).val()];

      for (var i=0; i<$('.skill-item').length; i++) {
        if ($('.skill-item').eq(i).attr('data-id') == selectSkill.no) {
          $('.skill-item').eq(i).find('.skill-bg').removeClass('slot1').removeClass('slot2').removeClass('slot3').removeClass('slot4');
          $('.skill-item').eq(i).find('.skill-bg').addClass(priority);
          break;
        }
      }

      for (var i=0; i<$('.skill-slot').length; i++) {
        if ($('.skill-slot').eq(i).attr('data-tab') == $('.type-tab.active').attr('data-id')
          && $('.skill-slot').eq(i).attr('data-id')
          && $('.skill-slot').eq(i).attr('data-id') == selectSkill.no) {
          
          $('.skill-slot').eq(i).find('.skill-bg').removeClass('slot1').removeClass('slot2').removeClass('slot3').removeClass('slot4');
          $('.skill-slot').eq(i).find('.skill-bg').addClass(priority);
        }
      }

      for (var i=0; i<jobSkill.length; i++) {
        if (selectSkill.no == jobSkill[i].no) {
          jobSkill[i].priority[$('.type-tab.active').attr('data-id')] = $(this).val();
          break;
        }
      }

      $('.skill-icon').find('.skill-bg').removeClass('slot1').removeClass('slot2').removeClass('slot3').removeClass('slot4');
      $('.skill-icon').find('.skill-bg').addClass(priority);
    });

    $('#skill-awake-check').on('change', function() {
      for (var i=0; i<jobSkill.length; i++) {
        if (jobSkill[i].isAwake != undefined) {
          jobSkill[i].isAwake = false;
        }

        if (selectSkill.no == jobSkill[i].no) {
          jobSkill[i].isAwake = true;
        }

        for (var j=0; j<$('.skill-special-slot').length; j++) {
          $('.skill-special-slot').eq(j).removeClass('active');
          if ($('.skill-special-slot').eq(j).attr('data-id') == selectSkill.no) {
            $('.skill-special-slot').eq(j).addClass('active');
          }
        }
      }
    });

    $('input[name=options1]').on('change', function() {
      $('#hp-range').prop('disabled', $(this).attr('data-id') == 3);

      if ($(this).attr('data-id') == 3) {
        $('#hp-label').text('체력');
      } else {
        $('#hp-label').text('체력 ' + $('#hp-range').val() + '%');
        $('#hp-range').show();
      }
      setCoast();
    });

    $('input[name=options2]').on('change', function() {
      $('#mp-range').prop('disabled', $(this).attr('data-id') == 3);

      if ($(this).attr('data-id') == 3) {
        $('#mp-label').text('마력');
      } else {
        $('#mp-label').text('마력 ' + $('#mp-range').val() + '%');
        $('#mp-range').show();
      }
      setCoast();
    });

    $('#hp-range').on('change', function() {
      $('#hp-label').text('체력 ' + $(this).val() + '%');
      setCoast();
    });

    $('#mp-range').on('change', function() {
      $('#mp-label').text('마력 ' + $(this).val() + '%');
      setCoast();
    });

    function setCoast() {
      var coast = ['', ''];

      if ($('input[name=options1]:checked').attr('data-id') != '3') {
        var updown = ($('input[name=options1]:checked').attr('data-id') == '1' ? 'U' : 'D');
        coast[0] = 'H' + $('#hp-range').val() + updown;
      }

      if ($('input[name=options2]:checked').attr('data-id') != '3') {
        var updown = ($('input[name=options2]:checked').attr('data-id') == '1' ? 'U' : 'D');
        coast[1] = 'M' + $('#mp-range').val() + updown;
      }

      var result = coast.filter((x) => x !== '').join('/');
      for (var i=0; i<jobSkill.length; i++) {
        if (jobSkill[i].no == selectSkill.no) {
          if (result == '') {
            delete jobSkill[i].use;
          } else {
            jobSkill[i].use = result;
          }
          break;
        }
      }
    }

    $('.skill-set-btn').on('click', function() {
      $('.skill-set-btn').attr('data-active', 'true');
      $('.skill-setting-container').collapse('hide');
      $('.safe-container').addClass('active');
    });

    $('.skill-set-done-btn').on('click', function() {
      $('.skill-set-btn').attr('data-active', 'false');
      $('.safe-container').removeClass('active');
    });

    $('input[name=fire-options]').on('change', function() {
      var upgrade = 'N';
      if ($('input[name=fire-options]:checked').attr('data-id') == '1') {
        upgrade = 'Y';
      }
      for (var i=0; i<jobSkill.length; i++) {
        if (jobSkill[i].no == selectSkill.no) {
          jobSkill[i].upgrade = upgrade;
          break;
        }
      }
    });

    $(document).on('click', '.skill-slot', function() {
      if ($(this).attr('disabled') || $('.skill-set-btn').attr('data-active') == 'false') {
        return
      }

      const page = $(this).attr('data-page');
      const isActive = ($('.skill-set-btn').attr('data-active') == 'true');

      if (isActive) {
        if ($(this).attr('data-id') && $(this).attr('data-id') == selectSkill.no) {
          $(this).removeAttr('data-id');
          $(this).html('<div class="skill-item"><div class="skill-bg"></div></div>');
        } else {
          for (var i=0; i<$('.skill-slot').length; i++) {
            if ($('.skill-slot').eq(i).attr('data-page') == page 
              && $('.skill-slot').eq(i).attr('data-id') && $('.skill-slot').eq(i).attr('data-id') == selectSkill.no
              && $('.skill-slot').eq(i).attr('data-tab') == $('.type-tab.active').attr('data-id')) {
                $('.skill-slot').eq(i).removeAttr('data-id');
                $('.skill-slot').eq(i).html('<div class="skill-item"><div class="skill-bg"></div></div>');
                break;
            }
          }
          for (var i=0; i<jobSkill.length; i++) {
            if (jobSkill[i].no == selectSkill.no) {
              const priority = ['slot1', 'slot2', 'slot3',  'slot4'][jobSkill[i].priority[$('.type-tab.active').attr('data-id')]];

              $(this).attr('data-id', jobSkill[i].no);
              $(this).find('.skill-item').find('.skill-bg').addClass(priority);

              if (jobSkill[i].no == 'C0' || jobSkill[i].no == 'C1') {
                $(this).find('.skill-item').find('.skill-bg').html('<img src="assets/img/skill_icon_combo.png">');
                $(this).find('.skill-item').find('.skill-bg').addClass('combo');
                $(this).find('.skill-item').find('.skill-bg').append('<span>' + (jobSkill[i].no == 'C0' ? '1' : '2') + '</span>');
              } else {
                $(this).find('.skill-item').find('.skill-bg').html('<img src="assets/img/skill/ic_' + jobSkill[i].no + '.png">');
              }

              if (jobSkill[i].awake != 0) {
                if (jobSkill[i].isAwake) {
                  $(this).find('.skill-item').append('<div class="skill-special-slot active" data-id="' + jobSkill[i].no + '"></div>');
                } else {
                  $(this).find('.skill-item').append('<div class="skill-special-slot" data-id="' + jobSkill[i].no + '"></div>');
                }
              }
              break;
            }
          }
        }
      } else {
        $(this).removeAttr('data-id');
        $(this).html('<div class="skill-item"><div class="skill-bg"></div></div>');
      }
    });

    $('.type-tab').on('click', function() {
      $('.skill-setting-container').collapse('hide');

      if (job == '8') {
        $('.upgrade-input').eq(upgrade[$(this).attr('data-id')]).prop('checked', true);
      }

      for (var i=0; i<$('.skill-list > .skill-item').length; i++) {
        for (var j=0; j<jobSkill.length; j++) {
          if ($('.skill-icon').attr('data-id') == jobSkill[j].no) {
            const priority = ['slot1', 'slot2', 'slot3',  'slot4'][jobSkill[j].priority[$(this).attr('data-id')]];
            if (!$('.skill-icon').find('.skill-bg').hasClass(priority)) {
              $('.skill-icon').find('.skill-bg').removeClass('slot1').removeClass('slot2').removeClass('slot3').removeClass('slot4');
              $('.skill-icon').find('.skill-bg').addClass(priority);
            }
          }
          if ($('.skill-list > .skill-item').eq(i).attr('data-id') == jobSkill[j].no) {
            const priority = ['slot1', 'slot2', 'slot3',  'slot4'][jobSkill[j].priority[$(this).attr('data-id')]];
            if (!$('.skill-list > .skill-item').eq(i).find('.skill-bg').hasClass(priority)) {
              $('.skill-list > .skill-item').eq(i).find('.skill-bg').removeClass('slot1').removeClass('slot2').removeClass('slot3').removeClass('slot4');
              $('.skill-list > .skill-item').eq(i).find('.skill-bg').addClass(priority);
            }
            break;
          }
        }
      }
    });

    $('.skill-combo-set-btn').on('click', function() {
      if ($('.skill-combo-set-btn').attr('data-active') == 'true') {
        $('.skill-combo-set-btn').attr('data-active', 'false');
        $('.safe-container2').removeClass('active');
        
        for (var i=0; i<jobSkill.length; i++) {
          if (jobSkill[i].no == comboSelectSkill.no) {
            jobSkill[i] = comboSelectSkill;
            break;
          }
        }
        comboSelectSkill = null;
      } else {
        $('.skill-combo-set-btn').attr('data-active', 'true');
        $('.safe-container2').addClass('active');
        comboSelectSkill = selectSkill;
      }
    });

    function setComboSkillContainer() {
      if (comboSelectSkill.skills.length > $('.skill-combo').length) {
        comboSelectSkill.skills = comboSelectSkill.skills.slice(0, $('.skill-combo').length);
        return;
      }
      if (comboSelectSkill.skills.length > 0) {
        for (var i=0; i<$('.skill-combo').length; i++) {
          $('.skill-combo').eq(i).find('.skill-item').find('.skill-bg').removeClass('slot2');
          $('.skill-combo').eq(i).find('.skill-item').find('.skill-bg').html('');

          if (comboSelectSkill.skills.length > i) {
            $('.skill-combo').eq(i).find('.skill-item').find('.skill-bg').addClass('slot2');
            $('.skill-combo').eq(i).find('.skill-item').find('.skill-bg').html('<img src="assets/img/skill/ic_' + comboSelectSkill.skills[i] + '.png">');
          }
        }
      } else {
        for (var i=0; i<$('.skill-combo').length; i++) {
          $('.skill-combo').eq(i).find('.skill-item').find('.skill-bg').removeClass('slot2');
          $('.skill-combo').eq(i).find('.skill-item').find('.skill-bg').html('');
        }
      }
    }

    $('.skill-combo').on('click', function() {
      if (comboSelectSkill != null && comboSelectSkill.skills.length > parseInt($(this).attr('data-idx'))) {
        var skills = [];
        for (var i=0; i<comboSelectSkill.skills.length; i++) {
          if (i != parseInt($(this).attr('data-idx'))) {
            skills.push(comboSelectSkill.skills[i]);
          }
        }
        comboSelectSkill.skills = skills;
        setComboSkillContainer();
      }
    });

    $('.upgrade-input').on('click', function() {
      upgrade[$('.type-tab.active').attr('data-id')] = parseInt($(this).attr('data-id'));
    });

    $('.btn-save').on('click', function() {
      if (isLoading) {
        return;
      }

      if ($('.title-input').val().trim().length == 0) {
        alert('제목을 적어주세요.');
        return;
      }

      isLoading = true;
      var list = [{'skill': [['', '', '', '', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', '', '', '', '', '']], 'priority': [['', '', '', '', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', '', '', '', '', '']], 'upgrade': '', 'C0': [], 'C1': []},
                  {'skill': [['', '', '', '', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', '', '', '', '', '']], 'priority': [['', '', '', '', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', '', '', '', '', '']], 'upgrade': '', 'C0': [], 'C1': []},
                  {'skill': [['', '', '', '', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', '', '', '', '', '']], 'priority': [['', '', '', '', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', '', '', '', '', '']], 'upgrade': '', 'C0': [], 'C1': []}];

      if (job == '9') {
        list[0].fire = [];
        list[1].fire = [];
        list[2].fire = [];
      }
      var coast = [['', '', '', '', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', '', '', '', '', '']];
      var awake = '';

      var skillHash = {};
      for (var i=0; i<jobSkill.length; i++) {
        skillHash[jobSkill[i].no] = jobSkill[i];
      }

      for (var i=0; i<$('.page-contents').length; i++) {
        const slot1 = $('.page-contents').eq(i).find('.skill-container').eq(0).find('.skill-slot');
        const slot2 = $('.page-contents').eq(i).find('.skill-container').eq(1).find('.skill-slot');
        for (var j=0; j<slot1.length; j++) {
          var id = slot1.eq(j).attr('data-id');
          if (id) {
            list[i].skill[0][j] = id;
            list[i].priority[0][j] = skillHash[id].priority[i];
            coast[0][j] = skillHash[id].use;

            if (skillHash[id].isAwake) {
              awake = id;
            }

            if (id == 'C0' || id == 'C1') {
              list[i][id] = skillHash[id].skills;
            }
            
            if (job == '9' && skillHash[id].upgrade == 'Y') {
              list[i].fire.push(id);
            }
          }

          if (list[i].upgrade == '' && job == '8') {
            list[i].upgrade = upgrade[i];
          }
        }

        for (var j=0; j<slot2.length; j++) {
          var id = slot2.eq(j).attr('data-id');
          if (id) {
            list[i].skill[1][j] = id;

            list[i].priority[1][j] = parseInt(skillHash[id].priority[i]);
            if (skillHash[id].use) {
              coast[1][j] = skillHash[id].use;
            }

            if (skillHash[id].isAwake) {
              awake = id;
            }

            if (id == 'C0' || id == 'C1') {
              list[i][id] = skillHash[id].skills;
            }

            if (job == '9' && skillHash[id].upgrade == 'Y') {
              list[i].fire.push(id);
            }
          }

          if (list[i].upgrade == '' && job == '8') {
            list[i].upgrade = upgrade[i];
          }
        }
      }

      if (docUid == loginUid) {
        updateSkill(job, JSON.stringify(list[0]), JSON.stringify(list[1]), JSON.stringify(list[2]), JSON.stringify(coast), awake, $('.title-input').val().trim());
      } else {
        addSkill(job, JSON.stringify(list[0]), JSON.stringify(list[1]), JSON.stringify(list[2]), JSON.stringify(coast), awake, $('.title-input').val().trim());
      }
    });

    $('.job-btn').on('click', function() {
      location.href = 'skilltree.html?job=' + job;
    });

    var isRunLike = false;
    $('.skill-like').on('click', function() {
      if (docUid == loginUid) {
        alert('나의 스킬 트리 페이지에서 확인 할 수 있습니다!');
      } else if (!isRunLike && docUid != '' && loginUid != '') {
        isRunLike = true;
        const likeRef = collection(db, 'likes');
        const skillRef = collection(db, 'skill');
        const likeQuery = query(likeRef, where('uid', '==', loginUid), where('sid', '==', docId));
        const skillQuery = query(doc(skillRef, docId));

        getDocs(likeQuery).then((result) => {
          if (result.docs.length == 0) {
            addDoc(likeRef, {
              uid: loginUid,
              sid: docId,
              date: serverTimestamp(),
              title: docTitle,
              job: parseInt(job)
            }).then((docRef) => {
              $('.skill-like > i').removeClass('bi-star');
              $('.skill-like > i').addClass('bi-star-fill');
              isRunLike = false;
            }).catch((error) => {
              alert('일시적인 오류로 즐겨찾기에 추가히자 못했습니다.');
              isRunLike = false;
            });

            updateDoc(skillQuery, {
              like: increment(1)
            });
          } else {
            // delete
            result.docs.forEach((doc) => {
              deleteDoc(doc.ref);
            });

            updateDoc(skillQuery, {
              like: increment(-1)
            }).then((docRef) => {
              $('.skill-like > i').removeClass('bi-star-fill');
              $('.skill-like > i').addClass('bi-star');
              isRunLike = false;
            });
          }
        });
      } else {
        alert('로그인이 필요합니다.');
        isRunLike = false;
      }
    });
  </script>

  <script>
    const docSkill = [[['', '', '', '', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', '', '', '', '', '']], [['', '', '', '', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', '', '', '', '', '']], [['', '', '', '', '', '', '', '', '', '', '', '', ''], ['', '', '', '', '', '', '', '', '', '', '', '', '']]];
    
    $(document).ready(function() {
      Kakao.init('5472dfb0e36ff14873f3613a0e9b9d50');
    });
  </script>
</body>
</html>